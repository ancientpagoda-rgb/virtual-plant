<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASCII Vine Garden</title>
  <style>
    :root{
      --bg:#000;
      --fg:#33ff66;
      --fg2:#1edc54;
    }
    html,body{height:100%;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      overflow:hidden;
    }
    #screen{
      position:fixed;
      inset:0;
      padding:14px;
      white-space:pre;
      line-height:1.0;
      font-size:14px;
      text-shadow: 0 0 10px rgba(51,255,102,0.12);
      user-select:none;
    }
    #hud{
      position:fixed;
      left:12px;
      top:10px;
      color:rgba(51,255,102,0.75);
      font-size:12px;
      pointer-events:none;
    }
    #hud kbd{border:1px solid rgba(51,255,102,0.35); padding:1px 6px; border-radius:8px;}
  </style>
</head>
<body>
  <div id="hud">ASCII Vine Garden — <kbd>H</kbd> hide HUD · <kbd>R</kbd> reset · <kbd>Space</kbd> burst</div>
  <pre id="screen" aria-label="ASCII garden"></pre>

  <script>
  // ASCII Vine Garden — fast "jungle" growth
  const LS_KEY = 'asciiGarden.v1';

  const CHAR = {
    empty: ' ',
    stem: '|',
    vineL: '/',
    vineR: '\\',
    leaf: '*',
    bud: '+',
    flower: '@',
    thorn: '.',
  };

  function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
  function now(){ return Date.now(); }

  function load(){
    try{ const r = localStorage.getItem(LS_KEY); return r? JSON.parse(r): null; }catch{ return null; }
  }
  function save(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }

  // deterministic RNG per plant
  function xorshift(seed){
    let x = seed|0;
    return ()=>{
      x ^= x << 13; x |= 0;
      x ^= x >>> 17;
      x ^= x << 5;  x |= 0;
      return (x >>> 0) / 4294967296;
    };
  }

  function screenSize(){
    const el = document.getElementById('screen');
    // Estimate columns/rows from element size & computed font metrics
    const cs = getComputedStyle(el);
    const fontSize = parseFloat(cs.fontSize) || 14;
    // Approx monospace char width ~0.6em
    const charW = fontSize * 0.60;
    const charH = fontSize * 1.00;
    const pad = 28;
    const cols = Math.max(40, Math.floor((window.innerWidth - pad)/charW));
    const rows = Math.max(16, Math.floor((window.innerHeight - pad)/charH));
    return {cols, rows};
  }

  function newState(){
    const t = now();
    return {
      createdAt: t,
      lastTickAt: t,
      cols: 0,
      rows: 0,
      plants: [],
      ticks: 0,
    };
  }

  function ensurePlants(state, count){
    while(state.plants.length < count){
      const seed = (state.createdAt/1000|0) ^ (state.plants.length*2654435761);
      const r = xorshift(seed);
      state.plants.push({
        id: state.plants.length,
        seed,
        x: 0, y: 0,
        dir: (r()<0.5?-1:1),
        energy: 40 + Math.floor(r()*60),
        age: 0,
        kind: r()<0.55? 'vine' : (r()<0.8? 'branch' : 'ivy'),
        r: null,
        alive: true,
      });
    }
  }

  function resizeIfNeeded(state){
    const {cols, rows} = screenSize();
    const changed = cols !== state.cols || rows !== state.rows;
    state.cols = cols; state.rows = rows;
    if(changed){
      // re-seed plant x positions across bottom
      const n = state.plants.length || 1;
      state.plants.forEach((p,i)=>{
        const r = p.r || (p.r = xorshift(p.seed));
        p.x = clamp(Math.floor((i+0.5) * cols / n + (r()-0.5)*6), 1, cols-2);
        p.y = rows-2;
      });
    }
  }

  function blankGrid(cols, rows){
    const g = new Array(rows);
    for(let y=0;y<rows;y++) g[y] = new Array(cols).fill(CHAR.empty);
    return g;
  }

  function put(g,x,y,ch){
    if(y<0||x<0||y>=g.length||x>=g[0].length) return;
    g[y][x] = ch;
  }

  function maybeLeaf(r){
    const v = r();
    if(v < 0.06) return CHAR.flower;
    if(v < 0.18) return CHAR.bud;
    if(v < 0.55) return CHAR.leaf;
    return null;
  }

  function stepPlant(state, g, plant, steps){
    if(!plant.alive) return;
    const r = plant.r || (plant.r = xorshift(plant.seed));

    for(let s=0;s<steps;s++){
      plant.age++;
      if(plant.energy-- <= 0){ plant.alive = false; break; }

      // draw current segment
      put(g, plant.x, plant.y, CHAR.stem);

      // move up most of the time
      const up = r() < 0.82;
      if(up) plant.y -= 1;

      // drift sideways depending on kind
      let dx = 0;
      if(plant.kind === 'vine'){
        if(r() < 0.55) dx = plant.dir;
        if(r() < 0.08) plant.dir *= -1;
      }else if(plant.kind === 'branch'){
        if(r() < 0.40) dx = plant.dir;
        if(r() < 0.18) plant.dir *= -1;
        // occasional split: spawn a child vine
        if(r() < 0.035 && state.plants.length < 60){
          const childSeed = (plant.seed ^ (plant.age*1103515245))|0;
          const cr = xorshift(childSeed);
          state.plants.push({
            id: state.plants.length,
            seed: childSeed,
            x: plant.x,
            y: plant.y,
            dir: cr()<0.5?-1:1,
            energy: 18 + Math.floor(cr()*45),
            age: 0,
            kind: cr()<0.7?'vine':'ivy',
            r: null,
            alive: true,
          });
        }
      }else if(plant.kind === 'ivy'){
        if(r() < 0.65) dx = plant.dir;
        if(r() < 0.12) plant.dir *= -1;
      }

      const nx = clamp(plant.x + dx, 1, state.cols-2);
      const ny = clamp(plant.y, 0, state.rows-2);

      // draw the connecting char if we moved sideways
      if(nx !== plant.x){
        put(g, nx, ny, dx < 0 ? CHAR.vineL : CHAR.vineR);
      }

      plant.x = nx;
      plant.y = ny;

      // add leaves/buds/flowers
      const deco = maybeLeaf(r);
      if(deco){
        put(g, clamp(plant.x + (r()<0.5?-1:1), 1, state.cols-2), clamp(plant.y + (r()<0.7?0:1), 0, state.rows-2), deco);
      }

      // stop if reached top
      if(plant.y <= 1){
        plant.alive = false;
        break;
      }
    }
  }

  function tick(state){
    resizeIfNeeded(state);

    // Jungle density: start with 30 base plants
    ensurePlants(state, 30);

    // Each tick we grow a lot (fast)
    const t = now();
    const dt = Math.max(0, t - state.lastTickAt);
    state.lastTickAt = t;

    // base: 12 steps per tick, plus a little time-based catch-up
    const steps = 10 + Math.min(20, Math.floor(dt / 120));

    const g = blankGrid(state.cols, state.rows);

    // ground line
    for(let x=0;x<state.cols;x++) put(g,x,state.rows-1,'_');

    // plants
    const localPlants = state.plants; // may grow during stepping
    const maxIter = localPlants.length;
    for(let i=0;i<maxIter;i++){
      const p = localPlants[i];
      // respawn dead plants sometimes
      if(!p.alive && Math.random() < 0.02){
        const r = p.r || (p.r = xorshift(p.seed));
        p.alive = true;
        p.energy = 25 + Math.floor(r()*70);
        p.x = clamp(p.x + Math.floor((r()-0.5)*6), 1, state.cols-2);
        p.y = state.rows-2;
      }
      stepPlant(state, g, p, steps);
    }

    state.ticks++;

    const text = g.map(r=>r.join('')).join('\n');
    document.getElementById('screen').textContent = text;

    // persist every few ticks
    if(state.ticks % 6 === 0) save(state);
  }

  function reset(){
    const s = newState();
    save(s);
    return s;
  }

  let state = load() || newState();
  // seed initial sizes/plants
  ensurePlants(state, 30);
  resizeIfNeeded(state);

  // Controls
  document.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase() === 'h'){
      const hud = document.getElementById('hud');
      hud.style.display = (hud.style.display === 'none') ? 'block' : 'none';
    }
    if(e.key.toLowerCase() === 'r'){
      state = reset();
    }
    if(e.code === 'Space'){
      // burst: temporarily boost energies and add a few plants
      for(const p of state.plants){ p.energy += 8; }
      ensurePlants(state, Math.min(45, state.plants.length + 6));
    }
  });

  window.addEventListener('resize', ()=>{
    resizeIfNeeded(state);
  });

  // Fast render loop
  tick(state);
  setInterval(()=>tick(state), 120);
  </script>
</body>
</html>
